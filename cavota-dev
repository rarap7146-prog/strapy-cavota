#!/bin/bash
# Cavota Development Manager

case "$1" in
  start)
    echo "Starting Cavota services..."
    
    # Start Strapi backend in tmux session
    tmux new-session -d -s strapi-backend "cd /var/www/linkgacor.one/backend && npm run develop"
    
    # Start Next.js frontend in tmux session
    tmux new-session -d -s nextjs-frontend "cd /var/www/linkgacor.one/frontend && npm run dev"
    
    echo "‚úÖ Services started:"
    echo "üì¶ Strapi: tmux attach-session -t strapi-backend"
    echo "üåê Next.js: tmux attach-session -t nextjs-frontend"
    echo "üîç Status: cavota-dev status"
    ;;
    
  start-prod)
    echo "Starting Cavota production services..."
    
    # Build and start production
    cd /var/www/linkgacor.one/frontend && npm run build
    tmux new-session -d -s strapi-prod "cd /var/www/linkgacor.one/backend && npm run start"
    tmux new-session -d -s nextjs-prod "cd /var/www/linkgacor.one/frontend && npm run start"
    
    echo "‚úÖ Production services started"
    ;;
    
  stop)
    echo "Stopping all Cavota services..."
    tmux kill-session -t strapi-backend 2>/dev/null
    tmux kill-session -t nextjs-frontend 2>/dev/null
    tmux kill-session -t strapi-prod 2>/dev/null
    tmux kill-session -t nextjs-prod 2>/dev/null
    echo "‚úÖ All services stopped"
    ;;
    
  status)
    echo "Cavota Services Status:"
    echo "======================"
    
    if tmux has-session -t strapi-backend 2>/dev/null; then
      echo "üì¶ Strapi Backend: ‚úÖ Running (dev)"
    elif tmux has-session -t strapi-prod 2>/dev/null; then
      echo "üì¶ Strapi Backend: ‚úÖ Running (prod)"
    else
      echo "üì¶ Strapi Backend: ‚ùå Stopped"
    fi
    
    if tmux has-session -t nextjs-frontend 2>/dev/null; then
      echo "üåê Next.js Frontend: ‚úÖ Running (dev)"
    elif tmux has-session -t nextjs-prod 2>/dev/null; then
      echo "üåê Next.js Frontend: ‚úÖ Running (prod)"
    else
      echo "üåê Next.js Frontend: ‚ùå Stopped"
    fi
    
    echo ""
    echo "üíª Access:"
    echo "Frontend: https://cavota.id"
    echo "Backend: http://localhost:1337/admin"
    ;;
    
  logs)
    case "$2" in
      frontend|next)
        if tmux has-session -t nextjs-frontend 2>/dev/null; then
          tmux attach-session -t nextjs-frontend
        elif tmux has-session -t nextjs-prod 2>/dev/null; then
          tmux attach-session -t nextjs-prod
        else
          echo "‚ùå Frontend not running"
        fi
        ;;
      backend|strapi)
        if tmux has-session -t strapi-backend 2>/dev/null; then
          tmux attach-session -t strapi-backend
        elif tmux has-session -t strapi-prod 2>/dev/null; then
          tmux attach-session -t strapi-prod
        else
          echo "‚ùå Backend not running"
        fi
        ;;
      *)
        echo "Usage: cavota-dev logs [frontend|backend]"
        ;;
    esac
    ;;
    
  restart)
    $0 stop
    sleep 2
    $0 start
    ;;
    
  *)
    echo "Cavota Development Manager"
    echo "========================="
    echo "Usage: cavota-dev [command]"
    echo ""
    echo "Commands:"
    echo "  start      - Start development servers"
    echo "  start-prod - Start production servers"  
    echo "  stop       - Stop all servers"
    echo "  status     - Show service status"
    echo "  restart    - Restart all services"
    echo "  logs [service] - View logs (frontend|backend)"
    echo ""
    echo "Examples:"
    echo "  cavota-dev start"
    echo "  cavota-dev logs frontend"
    echo "  cavota-dev status"
    ;;
esac